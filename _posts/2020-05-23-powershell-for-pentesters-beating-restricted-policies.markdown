---
layout: post
title:  "Powershell For Penetration Testers Beating Restricted Policies"
author: nanobyte
date:   2020-05-23
description: PowerShell for Penetration Testing, and how to beat restricted policies to run commands and scripts
tags: PowerShell
---

Recently, while I was going for my Offensive Security Certified Professional (OSCP) certificate, I ran into a machine in the labs which had a restricted PowerShell. Simply stated, I could not enter into an interactive PowerShell session or run any PowerShell scripts. PowerShell has several execution policies which can be set on a system, and these execution policies determines which scripts can be run. By default, this is set to "Restricted". From Microsoft, restricted "doesn't load configuration files or run scripts. The default execution policy Windows client computers."

However, there is an execution policy which, as penetration testers, we want to have set. That execution policy is "Bypass", which states "nothing is blocked and there are no warnings or prompts." Luckily, we are able run a command or script with PowerShell's bypass execution policy set with an option. Now, even though the default restricted policy is set, our commands will still run. To run a PowerShell command with bypass:

{% highlight bash linenos %}
powershell -ExecutionPolicy Bypass -Command "whoami"
{% endhighlight %}

Or, for shorthand:

{% highlight bash linenos %}
powershell -exec bypass -c "whoami"
{% endhighlight %}

Now, even though the system is restricted, PowerShell can still be leveraged! Let's build on this and take it another step further. When you enter a PowerShell session or run a script, you run it in the context of the current profile. As penetration testers, we may not know what is within these profiles. For best practices, we can supply the No Profile flag which will run our script without using any profile:

{% highlight bash linenos %}
powershell -ExecutionPolicy Bypass -NoProfile -Command "whoami"
{% endhighlight %}

Or, another shorthand:

{% highlight bash linenos %}
powershell -exec bypass -nop -c "whoami"
{% endhighlight %}
